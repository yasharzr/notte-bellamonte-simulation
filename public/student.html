<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notte Bellamonte - Student</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }

    .container { max-width: 700px; margin: 0 auto; }

    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { font-size: 28px; margin-bottom: 5px; color: #fff; }
    .header p { font-size: 14px; color: #aaa; }

    .phase-badge {
      display: inline-block; padding: 6px 12px; background: #d4af37;
      color: #000; border-radius: 20px; font-size: 12px; font-weight: 600; margin-top: 10px;
    }

    .card {
      background: #2a2a3e; border: 1px solid #444;
      border-radius: 8px; padding: 25px; margin-bottom: 20px;
    }

    .scenario-intro {
      background: linear-gradient(135deg, #6b4423 0%, #3d2817 100%);
      border-left: 4px solid #d4af37; padding: 20px; margin-bottom: 20px; border-radius: 4px;
    }
    .scenario-intro h2 { font-size: 20px; margin-bottom: 10px; color: #d4af37; }
    .scenario-intro p { font-size: 14px; line-height: 1.6; color: #e0e0e0; }

    .vote-buttons { display: flex; flex-direction: column; gap: 12px; }

    .vote-btn {
      padding: 18px; border: 2px solid #555; background: #3a3a4e; color: #e0e0e0;
      border-radius: 6px; cursor: pointer; font-size: 15px; font-weight: 500;
      transition: all 0.2s; text-align: left;
    }
    .vote-btn:hover { background: #4a4a5e; border-color: #d4af37; transform: translateX(4px); }
    .vote-btn.active { background: #d4af37; color: #000; border-color: #d4af37; }
    .vote-btn .label { display: block; font-weight: 600; margin-bottom: 4px; }
    .vote-btn .sublabel { display: block; font-size: 12px; opacity: 0.8; }

    .button {
      padding: 14px 24px; background: #d4af37; color: #000; border: none;
      border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;
      width: 100%; transition: all 0.2s; margin-top: 15px;
    }
    .button:hover { background: #e8c547; transform: translateY(-2px); }
    .button:disabled { background: #888; cursor: not-allowed; transform: none; }

    .status-message {
      background: #3a5a4a; border-left: 4px solid #4ade80;
      padding: 15px; border-radius: 4px; margin-top: 15px; font-size: 14px;
    }
    .error { background: #5a3a3a; border-left-color: #f87171; color: #fca5a5; }

    .vote-count { margin-top: 10px; padding: 10px; background: #2a2a3e; border-radius: 4px; font-size: 13px; }
    .vote-count strong { color: #d4af37; }

    .hidden { display: none; }

    .join-form {
      background: #2a2a3e; border: 1px solid #444; border-radius: 8px;
      padding: 30px; max-width: 400px; margin: 50px auto;
    }
    .join-form h2 { margin-bottom: 20px; color: #d4af37; }

    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; }
    .form-group input {
      width: 100%; padding: 12px; background: #3a3a4e; border: 1px solid #555;
      border-radius: 4px; color: #e0e0e0; font-size: 14px;
    }
    .form-group input:focus { outline: none; border-color: #d4af37; background: #4a4a5e; }

    .phase-result {
      background: #3a5a4a; border-left: 4px solid #4ade80;
      padding: 15px; border-radius: 4px; margin-bottom: 20px;
    }
    .phase-result h3 { color: #4ade80; margin-bottom: 10px; }
    .result-item { display: flex; justify-content: space-between; padding: 8px 0; font-size: 14px; }
    .result-item strong { color: #d4af37; }

    /* ═══ PHASE 3: DRAMATIC UI ═══ */

    .p3-stage { animation: fadeSlideIn 0.5s ease; }
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulseGlow {
      0%, 100% { box-shadow: 0 0 20px rgba(212,175,55,0.3); }
      50% { box-shadow: 0 0 40px rgba(212,175,55,0.6); }
    }
    @keyframes priceReveal {
      from { transform: scale(0.5); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @keyframes pricePulse {
      0%, 100% { color: #f87171; }
      50% { color: #ff4444; }
    }

    /* Role Reveal */
    .role-reveal {
      text-align: center; padding: 60px 20px;
      background: linear-gradient(135deg, #1a1a2e 0%, #2a2a4e 100%);
      border-radius: 12px; border: 2px solid #d4af37;
      animation: pulseGlow 2s ease-in-out infinite;
    }
    .role-reveal .role-label-big {
      font-size: 14px; text-transform: uppercase; letter-spacing: 4px;
      color: #aaa; margin-bottom: 20px;
    }
    .role-reveal .role-name {
      font-size: 36px; font-weight: 800; letter-spacing: 3px; margin-bottom: 16px;
    }
    .role-reveal .role-tagline {
      font-size: 16px; font-style: italic; color: #ccc; max-width: 500px;
      margin: 0 auto 30px;
    }
    .role-reveal.lucia { border-color: #d4af37; }
    .role-reveal.lucia .role-name { color: #d4af37; }
    .role-reveal.marco { border-color: #7c8a9e; }
    .role-reveal.marco .role-name { color: #94a3b8; }

    /* Character Briefing */
    .dossier {
      background: #2a2a3e; border: 1px solid #555; border-radius: 10px;
      overflow: hidden;
    }
    .dossier-header {
      padding: 18px 24px; font-size: 18px; font-weight: 700;
    }
    .dossier-header.lucia { background: linear-gradient(135deg, #6b4423, #3d2817); color: #d4af37; }
    .dossier-header.marco { background: linear-gradient(135deg, #2a3a4e, #1a2a3e); color: #94a3b8; }
    .dossier-section {
      padding: 16px 24px; border-bottom: 1px solid #333;
    }
    .dossier-section:last-child { border-bottom: none; }
    .dossier-label {
      font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px;
      color: #888; margin-bottom: 6px; font-weight: 600;
    }
    .dossier-text { font-size: 14px; line-height: 1.6; color: #ccc; }

    /* Secret Briefing */
    .classified-box {
      border: 2px solid #c0392b; border-radius: 10px; overflow: hidden;
      margin-top: 20px; position: relative;
    }
    .classified-stamp {
      background: #c0392b; color: #fff; padding: 10px 20px;
      font-size: 14px; font-weight: 800; letter-spacing: 3px;
      text-transform: uppercase; text-align: center;
    }
    .classified-body { padding: 20px; background: #1e1e2e; }
    .secret-item {
      padding: 14px 0; border-bottom: 1px solid #333;
    }
    .secret-item:last-child { border-bottom: none; }
    .secret-label {
      font-size: 12px; font-weight: 700; color: #e74c3c;
      text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px;
    }
    .secret-text { font-size: 14px; line-height: 1.6; color: #ddd; }

    /* Mechanism Choice */
    .mechanism-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 20px 0; }
    .mechanism-card {
      padding: 24px; border: 2px solid #555; border-radius: 10px;
      background: #2a2a3e; cursor: pointer; transition: all 0.3s; text-align: center;
    }
    .mechanism-card:hover { border-color: #d4af37; background: #3a3a4e; transform: translateY(-3px); }
    .mechanism-card.selected { border-color: #d4af37; background: #3a3a4e; box-shadow: 0 0 20px rgba(212,175,55,0.3); }
    .mechanism-card h3 { font-size: 18px; color: #d4af37; margin-bottom: 10px; }
    .mechanism-card p { font-size: 13px; color: #aaa; line-height: 1.5; }

    /* Negotiation - Big Price */
    .big-price {
      font-size: 64px; font-weight: 900; text-align: center;
      color: #d4af37; padding: 30px; margin: 20px 0;
      background: linear-gradient(135deg, #2a2a3e, #1a1a2e);
      border: 2px solid #d4af37; border-radius: 12px;
      animation: priceReveal 0.6s ease;
    }
    .big-price.dropping {
      animation: pricePulse 1s ease-in-out infinite;
      border-color: #f87171;
    }

    /* Action buttons */
    .action-btn {
      display: block; width: 100%; padding: 24px;
      font-size: 20px; font-weight: 800; border: 3px solid;
      border-radius: 12px; cursor: pointer; transition: all 0.2s;
      text-align: center; margin-bottom: 12px;
      text-transform: uppercase; letter-spacing: 2px;
    }
    .action-btn:hover { transform: scale(1.02); }
    .action-btn:active { transform: scale(0.98); }
    .action-btn.buy-btn {
      background: rgba(74,222,128,0.1); color: #4ade80;
      border-color: #4ade80;
    }
    .action-btn.buy-btn:hover { background: rgba(74,222,128,0.2); }
    .action-btn.sell-btn {
      background: rgba(248,113,113,0.1); color: #f87171;
      border-color: #f87171;
    }
    .action-btn.sell-btn:hover { background: rgba(248,113,113,0.2); }

    .offer-input {
      width: 100%; padding: 20px; font-size: 28px; font-weight: 700;
      text-align: center; background: #1a1a2e; border: 2px solid #555;
      border-radius: 10px; color: #d4af37;
    }
    .offer-input:focus { outline: none; border-color: #d4af37; }
    .offer-input::placeholder { color: #555; }

    .submit-offer-btn {
      display: block; width: 100%; padding: 20px;
      font-size: 18px; font-weight: 800; background: #d4af37;
      color: #000; border: none; border-radius: 10px;
      cursor: pointer; margin-top: 16px; text-transform: uppercase;
      letter-spacing: 2px; transition: all 0.2s;
    }
    .submit-offer-btn:hover { background: #e8c547; transform: translateY(-2px); }

    .lock-btn {
      display: block; width: 100%; padding: 24px;
      font-size: 20px; font-weight: 800; background: #d4af37;
      color: #000; border: none; border-radius: 12px;
      cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
      transition: all 0.2s;
    }
    .lock-btn:hover { background: #e8c547; transform: scale(1.02); }

    /* Outcome */
    .outcome-box {
      text-align: center; padding: 40px 20px;
      background: linear-gradient(135deg, #1a3a2a, #1a2a1a);
      border: 2px solid #4ade80; border-radius: 12px;
    }
    .outcome-box h2 { font-size: 24px; color: #4ade80; margin-bottom: 20px; }
    .outcome-price { font-size: 56px; font-weight: 900; color: #d4af37; margin: 20px 0; }
    .outcome-detail { font-size: 16px; color: #ccc; margin-bottom: 8px; }

    .waiting-text {
      text-align: center; padding: 30px; color: #aaa; font-size: 16px;
    }
    .waiting-text .dots::after {
      content: ''; animation: dots 1.5s steps(3, end) infinite;
    }
    @keyframes dots {
      0% { content: '.'; }
      33% { content: '..'; }
      66% { content: '...'; }
    }

    .partner-badge {
      display: inline-block; padding: 8px 16px; border-radius: 20px;
      font-size: 14px; font-weight: 700; margin: 6px;
    }

    .no-pair-message {
      background: #4a5a6a; border-left: 4px solid #fbbf24;
      padding: 20px; border-radius: 4px; text-align: center;
    }

    @media (max-width: 500px) {
      .mechanism-cards { grid-template-columns: 1fr; }
      .big-price { font-size: 42px; padding: 20px; }
      .action-btn { font-size: 16px; padding: 18px; }
      .role-reveal .role-name { font-size: 28px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- LOGIN SCREEN -->
    <div id="loginScreen" class="join-form">
      <h2>Notte Bellamonte Winery</h2>
      <p style="color: #aaa; margin-bottom: 20px; font-size: 13px;">A Corporate Governance Simulation</p>
      <div class="form-group">
        <label>Session ID</label>
        <input type="text" id="sessionIdInput" placeholder="e.g., s12abc3def" autocomplete="off">
      </div>
      <div class="form-group">
        <label>Your Name</label>
        <input type="text" id="nameInput" placeholder="e.g., Alice" autocomplete="off">
      </div>
      <button class="button" onclick="joinSession()">Join Session</button>
      <div id="loginError" class="status-message error hidden" style="margin-top: 15px;"></div>
    </div>

    <!-- MAIN APP -->
    <div id="mainApp" class="hidden">
      <div class="header">
        <h1>Notte Bellamonte Winery</h1>
        <p id="phaseText"></p>
        <span class="phase-badge" id="phaseBadge"></span>
        <div id="roleBadge" class="hidden" style="margin-top:10px; padding:8px 16px; border-radius:20px; font-size:14px; font-weight:700; letter-spacing:1px; display:inline-block;"></div>
      </div>

      <!-- PHASE 1: DEBATE & VOTE -->
      <div id="phase1Container" class="hidden">
        <div class="card">
          <div class="scenario-intro">
            <h2>The Scenario</h2>
            <p>Lucia and Marco are 50/50 co-owners of <strong>Notte Bellamonte Winery</strong>, a family vineyard in the Niagara Falls region. They have no shareholder agreement, no shotgun clause, and no dispute resolution mechanism.</p>
            <p style="margin-top: 12px;">The winery was founded by their father, Alessandro Bellamonte, and has been in the family for two generations. Both siblings inherited equal shares after Alessandro's passing.</p>
            <p style="margin-top: 12px;"><strong>Lucia</strong> wants to preserve the family legacy. She believes in maintaining the boutique quality, the family brand, and the artisanal winemaking tradition that Alessandro built.</p>
            <p style="margin-top: 12px;"><strong>Marco</strong> wants to modernize the winery. He envisions automating production, scaling internationally, and potentially taking the company public or bringing in outside investors.</p>
            <p style="margin-top: 12px;">They are deadlocked. Nothing gets decided. Dividends don't get declared. The company stalls.</p>
            <p style="margin-top: 12px;"><strong>A court remedy is sought. The question: What legal doctrine applies?</strong></p>
          </div>

          <div id="characterSheet" class="hidden" style="background: #3a3a4e; border-radius: 6px; padding: 18px; margin-bottom: 20px; border-left: 4px solid #d4af37;">
            <h3 id="characterName" style="color: #d4af37; margin-bottom: 8px;"></h3>
            <p id="characterDesc" style="font-size: 13px; line-height: 1.6; color: #ccc;"></p>
          </div>

          <h3 style="margin-bottom: 15px; margin-top: 20px;">Your Vote: Which legal claim is strongest?</h3>

          <div class="vote-buttons">
            <button class="vote-btn" onclick="votePhase1('oppression')">
              <span class="label">Oppression Remedy (s.241 CBCA)</span>
              <span class="sublabel">Lucia's reasonable expectations as a 50% shareholder were violated by Marco's conduct</span>
            </button>
            <div style="background:#2a2a3e; border:1px solid #444; border-radius:6px; padding:14px 18px; margin:-4px 0; font-size:12px; color:#aaa; line-height:1.6;">
              <strong style="color:#d4af37;">Legal Doctrine:</strong> Under <em>CBCA s.241</em>, a court may grant relief where corporate conduct is "oppressive or unfairly prejudicial" to a stakeholder. The test asks whether the complainant had <strong>reasonable expectations</strong> that were violated. Key factors: Was there a pattern of exclusion? Were dividends cut without justification? Was self-dealing involved? The remedy is flexible: courts can order buyouts, restrain conduct, or vary shareholder rights.
            </div>

            <button class="vote-btn" onclick="votePhase1('dissolution')">
              <span class="label">Equitable Dissolution (s.214 CBCA)</span>
              <span class="sublabel">The company is hopelessly deadlocked and should be wound up entirely</span>
            </button>
            <div style="background:#2a2a3e; border:1px solid #444; border-radius:6px; padding:14px 18px; margin:-4px 0; font-size:12px; color:#aaa; line-height:1.6;">
              <strong style="color:#d4af37;">Legal Doctrine:</strong> Under <em>CBCA s.214</em>, a court may order dissolution where it is "just and equitable" to do so. This typically applies when there is a complete deadlock in management with no mechanism to break the impasse. Courts consider: Is the company's substratum (original purpose) gone? Has the relationship of trust and confidence broken down irreparably? Dissolution is considered a "last resort" and courts prefer less destructive remedies if available.
            </div>
          </div>

          <div id="phase1Submitted" class="status-message hidden">
            Your vote submitted. Waiting for others to vote...
            <div class="vote-count" id="phase1VoteCount"></div>
          </div>
          <div id="phase1Error" class="status-message error hidden"></div>
        </div>
      </div>

      <!-- PHASE 2: REMEDY SELECTION -->
      <div id="phase2Container" class="hidden">
        <div class="card">
          <div class="phase-result" id="phase1ResultDisplay"></div>

          <h3 style="margin-bottom: 15px;">Phase 2: What remedy should the court impose?</h3>

          <div class="vote-buttons">
            <button class="vote-btn" onclick="votePhase2('dissolution')">
              <span class="label">Equitable Dissolution</span>
              <span class="sublabel">Wind up the company, sell assets, and distribute proceeds when the relationship is irreparably broken</span>
            </button>
            <button class="vote-btn" onclick="votePhase2('shotgun')">
              <span class="label">Shotgun Sale</span>
              <span class="sublabel">One side names a price; the other must buy or sell at that price</span>
            </button>
            <button class="vote-btn" onclick="votePhase2('openmarket')">
              <span class="label">Open Market Sale</span>
              <span class="sublabel">Sell the business to an outside third party so the market determines fair value</span>
            </button>
          </div>

          <div id="phase2Submitted" class="status-message hidden">
            Your vote submitted. Waiting for others to vote...
            <div class="vote-count" id="phase2VoteCount"></div>
          </div>
          <div id="phase2Error" class="status-message error hidden"></div>
        </div>
      </div>

      <!-- PHASE 3: BUY-SELL EXECUTION (5-stage) -->
      <div id="phase3Container" class="hidden">

        <!-- Stage 1: Role Reveal -->
        <div id="p3RoleReveal" class="p3-stage hidden"></div>

        <!-- Stage 2: Character Briefing + Secrets -->
        <div id="p3CharacterBrief" class="p3-stage hidden"></div>

        <!-- Stage 3: Mechanism Choice -->
        <div id="p3MechanismChoice" class="p3-stage hidden"></div>

        <!-- Stage 4: Negotiation -->
        <div id="p3Negotiation" class="p3-stage hidden"></div>

        <!-- Stage 5: Outcome -->
        <div id="p3Outcome" class="p3-stage hidden"></div>

        <!-- Observer (no pair) -->
        <div id="p3Observer" class="p3-stage hidden">
          <div class="no-pair-message">
            <p style="font-size: 16px; font-weight: 600; color: #fbbf24;">You're the odd one out this round.</p>
            <p style="margin-top: 8px;">With an odd number of participants, one person sits out. Watch your classmates negotiate in real time!</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="student.js"></script>
</body>
</html>
